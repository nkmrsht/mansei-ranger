# EmailJS統合メール送信システム

## 概要
このシステムでは、Jicooで予約完了後に見積り詳細と予約情報を含む統合メールを顧客と管理者の両方に自動送信します。

## 特徴
- **Jicooからの通知は無効化**：重複を避けるため、Jicooからの自動メールは送信されません
- **統合メール1通のみ**：見積り詳細 + 予約情報を含む1通のメールを顧客・管理者の両方に送信
- **EmailJS使用**：信頼性の高いメール送信サービスを使用
- **シンプルな実装**：フロントエンドのみで完結

## EmailJS設定

### 現在の設定
- **Service ID**: `service_4s1vpt5`
- **Template ID**: `template_7ub57zd`
- **Public Key**: `J7015dA3yFurGOZbA`

### EmailJSテンプレート変数
以下の変数がEmailJSテンプレートで使用されます：

#### 顧客情報
- `{{customer_name}}` - 顧客名
- `{{customer_email}}` - 顧客メールアドレス
- `{{customer_phone}}` - 顧客電話番号

#### 予約情報
- `{{booking_date}}` - 工事予定日
- `{{booking_time}}` - 工事時間
- `{{booking_id}}` - 予約ID
- `{{booking_completed_at}}` - 予約完了日時

#### 見積り情報
- `{{estimate_created_at}}` - 見積り作成日時
- `{{base_price}}` - 基本工事費
- `{{total_price}}` - 合計金額
- `{{estimate_details}}` - 見積り詳細（Q&A形式）

#### 管理者情報
- `{{admin_email}}` - 管理者メールアドレス（manseijaaa@gmail.com）

#### 会社情報
- `{{company_name}}` - 電化のマンセイ
- `{{company_address}}` - 会社住所
- `{{company_hours}}` - 営業時間
- `{{company_line}}` - LINE URL
- `{{company_contact}}` - お問い合わせURL

## メール送信の流れ

1. **予約完了検知**：Jicooウィジェット内の「予約完了」テキストを監視
2. **データ統合**：見積りデータと予約データを統合
3. **EmailJS送信**：
   - 1回のAPI呼び出しで顧客・管理者両方に送信
   - 美しいHTMLテンプレートでメール送信

## テスト方法

### 1. EmailJS接続テスト
1. 予約ページの「🔑 EmailJS接続テスト」ボタンをクリック
2. テストデータでメール送信を確認
3. `manseijaaa@gmail.com`でメール受信を確認

### 2. 統合メール送信テスト
1. 見積りページで見積りを作成
2. 予約ページに移動
3. 「📧 統合メール送信テスト」ボタンをクリック
4. 見積り詳細+予約情報の統合メールを確認

### 3. 実際の予約テスト
1. Jicooウィジェットで実際に予約を完了
2. 予約完了後、自動的にメール送信が開始される
3. 送信状況がページ上に表示される

## トラブルシューティング

### メール送信が失敗する場合
1. **EmailJS設定を確認**
   - Service ID: `service_4s1vpt5`
   - Template ID: `template_7ub57zd`
   - Public Key: `J7015dA3yFurGOZbA`

2. **ネットワーク接続を確認**
   - EmailJS APIにアクセスできるか
   - ブラウザの開発者ツールでエラーメッセージを確認

3. **EmailJSダッシュボードを確認**
   - 月間送信制限に達していないか
   - テンプレートが正しく設定されているか

### Jicooからの重複メールが送信される場合
1. Jicoo管理画面で通知設定を確認
2. 予約完了メールを無効化
3. 管理者通知メールを無効化

## 本番環境での注意事項

1. **EmailJS制限**：無料プランは月200通まで
2. **メールアドレスの確認**：管理者メールアドレスが正しいか確認
3. **テンプレート設定**：EmailJSダッシュボードでテンプレートが正しく設定されているか確認
4. **セキュリティ**：Public Keyは公開されても問題ありませんが、Private Keyは秘匿

## 料金について

### EmailJS
- **無料プラン**：月200通まで
- **有料プラン**：月$15〜（より多くの送信が可能）

### 推奨設定
- 月間予約数が200件以下の場合：無料プランで十分
- それ以上の場合：有料プランへのアップグレードを検討

## システムの利点

### EmailJS一本化のメリット
1. **シンプルな実装**：フロントエンドのみで完結
2. **信頼性**：EmailJSは安定したサービス
3. **美しいメール**：HTMLテンプレートで見栄えの良いメール
4. **複数宛先対応**：1回の送信で顧客・管理者両方に配信
5. **メンテナンス性**：サーバーサイドの複雑な設定不要

### 削除された機能
- Web3Forms関連のコード・設定
- サーバーサイドWebhook処理
- 複雑なメール送信ロジック
- 重複するメール送信システム 